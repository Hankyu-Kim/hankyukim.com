---
import { menuLinks } from "@/site-config";

import Search from "../Search.astro";
import ThemeToggle from "../ThemeToggle.astro";

const url = new URL(Astro.request.url);
---

<header class="group relative mb-28 flex items-center sm:ps-[4.5rem]" id="main-header">
	<div class="flex sm:flex-col">
		<a
			aria-current={url.pathname === "/" ? "page" : false}
			class="inline-flex items-center grayscale hover:filter-none sm:relative sm:inline-block"
			href="/"
		>
			<svg
				version="1.0"
				xmlns="http://www.w3.org/2000/svg"
 				width="480.000000pt"
				height="480.000000pt"
				viewBox="0 0 480.000000 480.000000"
				preserveAspectRatio="xMidYMid meet"
				
				aria-hidden="true"
				class="me-3 h-10 w-6 sm:absolute sm:start-[-4.5rem] sm:me-0 sm:h-20 sm:w-12"
				fill="none"
				focusable="false"
				>

				<g transform="translate(0.000000,480.000000) scale(0.100000,-0.100000)"
				fill="#000000" stroke="none">
				<path d="M3916 4634 c-111 -27 -204 -80 -286 -163 -87 -87 -132 -165 -160
				-277 -36 -141 -21 -244 61 -407 73 -145 230 -359 389 -532 91 -98 99 -104 130
				-104 31 -1 49 14 135 109 213 235 377 477 436 647 105 300 -115 658 -446 728
				-87 18 -182 18 -259 -1z m204 -455 c42 -24 80 -83 80 -125 0 -76 -76 -154
				-150 -154 -46 0 -104 36 -129 80 -27 48 -27 92 0 140 42 74 127 99 199 59z"/>
				<path d="M1065 4279 c-205 -26 -430 -126 -552 -244 -49 -47 -55 -57 -49 -82
				16 -65 83 -82 138 -35 93 80 245 159 373 193 105 28 325 31 429 6 136 -34 272
				-100 375 -183 60 -49 99 -56 131 -24 12 12 20 33 20 54 0 28 -9 42 -52 81 -28
				25 -82 64 -118 86 -214 127 -455 178 -695 148z"/>
				<path d="M1091 3980 c-126 -18 -254 -71 -356 -148 -43 -32 -50 -43 -53 -76 -7
				-81 65 -102 147 -42 119 87 225 120 376 120 135 -1 232 -30 344 -105 50 -33
				84 -49 106 -49 44 0 67 28 63 76 -3 33 -11 44 -53 77 -66 50 -194 111 -275
				131 -84 20 -218 27 -299 16z"/>
				<path d="M1093 3675 c-69 -15 -151 -55 -195 -96 -51 -49 -26 -129 41 -129 16
				0 54 15 86 34 52 32 128 56 175 56 47 0 123 -24 175 -56 32 -19 70 -34 86 -34
				67 0 92 80 41 129 -46 42 -126 81 -199 96 -82 18 -129 18 -210 0z"/>
				<path d="M1550 3285 c-109 -18 -235 -59 -329 -105 -226 -114 -439 -342 -533
				-572 -34 -84 -78 -257 -78 -308 0 -45 -7 -54 -49 -68 -96 -33 -184 -114 -229
				-210 -27 -56 -27 -61 -30 -299 -3 -206 -6 -243 -18 -243 -26 0 -109 -92 -122
				-136 -16 -53 -16 -235 0 -288 16 -54 90 -128 144 -144 23 -7 98 -12 171 -12
				l130 0 12 -52 c55 -240 293 -413 542 -394 83 6 180 38 250 81 102 65 193 194
				220 313 l12 52 757 0 757 0 12 -52 c55 -240 293 -413 542 -394 83 6 180 38
				250 81 102 65 193 194 220 313 l12 52 130 0 c73 0 148 5 171 12 54 16 128 90
				144 144 16 53 16 235 0 288 -13 44 -96 136 -122 136 -10 0 -17 13 -21 38 -3
				20 -13 66 -21 102 -72 306 -330 554 -634 610 -36 7 -72 15 -80 19 -9 5 -19 37
				-26 87 -46 311 -218 588 -474 763 -149 102 -286 157 -460 186 -125 20 -1131
				20 -1250 0z m1195 -145 c39 -6 106 -21 150 -33 l80 -22 -615 -6 c-696 -6 -666
				-3 -845 -89 -156 -76 -261 -173 -357 -331 -57 -95 -108 -268 -108 -371 l0 -38
				-145 0 -145 0 0 34 c0 18 11 78 25 132 96 378 418 666 811 723 84 12 1064 13
				1149 1z m578 -289 c145 -154 240 -346 265 -538 l9 -63 -1200 0 -1199 0 7 66
				c9 86 29 151 73 244 80 166 289 323 472 353 14 2 359 5 766 6 l742 1 65 -69z
				m532 -779 c126 -43 204 -90 290 -177 120 -119 184 -257 200 -429 8 -87 26
				-116 71 -116 15 0 38 -12 55 -29 28 -28 29 -33 29 -121 0 -88 -1 -93 -30 -121
				l-29 -30 -122 3 -123 3 -11 52 c-20 88 -64 163 -139 239 -107 108 -219 154
				-371 154 -152 0 -264 -46 -371 -154 -75 -76 -119 -151 -139 -239 l-12 -52
				-753 0 -753 0 -12 52 c-20 88 -64 163 -139 239 -107 108 -219 154 -371 154
				-152 0 -264 -46 -371 -154 -75 -76 -119 -151 -139 -239 l-11 -52 -105 -3 c-89
				-2 -106 0 -116 15 -9 11 -13 56 -13 135 0 105 2 120 20 138 11 11 24 20 30 20
				5 0 17 14 25 30 10 20 26 33 45 37 l30 6 0 155 0 156 33 -54 c47 -79 109 -115
				197 -115 57 0 74 5 116 30 64 40 106 107 112 180 11 136 -111 256 -249 243
				-70 -7 -136 -51 -176 -118 l-33 -54 0 35 c0 79 63 192 113 202 12 3 726 4
				1587 3 l1565 -1 70 -23z m-3058 -224 c30 -28 29 -63 -2 -93 -30 -31 -62 -32
				-92 -3 -29 27 -29 65 -1 95 27 29 65 29 95 1z"/>
				<path d="M2350 2830 c-29 -29 -31 -49 -28 -263 3 -187 4 -198 25 -218 29 -29
				77 -29 106 0 21 20 22 31 25 218 2 108 1 207 -3 220 -14 58 -85 83 -125 43z"/>
				<path d="M2345 2005 l-25 -24 0 -406 0 -406 25 -24 c15 -16 36 -25 55 -25 19
				0 40 9 55 25 l25 24 0 406 0 406 -25 24 c-15 16 -36 25 -55 25 -19 0 -40 -9
				-55 -25z"/>
				<path d="M3625 2005 c-25 -24 -25 -26 -25 -205 0 -179 0 -181 25 -205 13 -14
				36 -25 50 -25 14 0 37 11 50 25 25 24 25 26 25 205 0 179 0 181 -25 205 -13
				14 -36 25 -50 25 -14 0 -37 -11 -50 -25z"/>
				<path d="M1597 502 c-23 -25 -22 -85 1 -105 14 -13 38 -17 90 -17 60 0 74 3
				92 22 11 12 20 34 20 48 0 14 -9 36 -20 48 -18 19 -32 22 -94 22 -58 0 -76 -4
				-89 -18z"/>
				<path d="M1970 498 c-11 -12 -20 -34 -20 -48 0 -14 9 -36 20 -48 l21 -22 598
				0 c567 0 599 1 614 18 23 25 22 85 -1 105 -17 15 -74 17 -615 17 l-596 0 -21
				-22z"/>
				<path d="M702 280 c-14 -14 -22 -33 -22 -55 0 -54 30 -75 107 -75 54 0 68 4
				88 25 14 13 25 36 25 50 0 14 -11 37 -25 50 -20 21 -34 25 -88 25 -50 0 -68
				-4 -85 -20z"/>
				<path d="M1075 275 c-14 -13 -25 -36 -25 -50 0 -14 11 -37 25 -50 l24 -25
				1301 0 1301 0 24 25 c32 31 32 69 0 100 l-24 25 -1301 0 -1301 0 -24 -25z"/>
				</g>
				</svg>
			<span class="text-xl font-bold sm:text-2xl">Hankyu Kim's blog</span>
		</a>
		<nav
			aria-label="Main menu"
			class="absolute -inset-x-4 top-14 hidden flex-col items-end gap-y-4 rounded-md bg-bgColor/[.85] py-4 text-accent shadow backdrop-blur group-[.menu-open]:z-50 group-[.menu-open]:flex sm:static sm:z-auto sm:-ms-4 sm:mt-1 sm:flex sm:flex-row sm:items-center sm:divide-x sm:divide-dashed sm:divide-accent sm:rounded-none sm:bg-transparent sm:py-0 sm:shadow-none sm:backdrop-blur-none"
			id="navigation-menu"
		>
			{
				menuLinks.map((link) => (
					<a
						aria-current={url.pathname === link.path ? "page" : false}
						class="px-4 py-4 underline-offset-2 sm:py-0 sm:hover:underline"
						data-astro-prefetch
						href={link.path}
					>
						{link.title}
					</a>
				))
			}
		</nav>
	</div>
	<Search />
	<ThemeToggle />
	<mobile-button>
		<button
			aria-expanded="false"
			aria-haspopup="menu"
			aria-label="Open main menu"
			class="group relative ms-4 h-7 w-7 sm:invisible sm:hidden"
			id="toggle-navigation-menu"
			type="button"
		>
			<svg
				aria-hidden="true"
				class="absolute start-1/2 top-1/2 h-full w-full -translate-x-1/2 -translate-y-1/2 transition-all group-aria-expanded:scale-0 group-aria-expanded:opacity-0"
				fill="none"
				focusable="false"
				id="line-svg"
				stroke="currentColor"
				stroke-width="1.5"
				viewBox="0 0 24 24"
				xmlns="http://www.w3.org/2000/svg"
			>
				<path d="M3.75 9h16.5m-16.5 6.75h16.5" stroke-linecap="round" stroke-linejoin="round"
				></path>
			</svg>
			<svg
				aria-hidden="true"
				class="absolute start-1/2 top-1/2 h-full w-full -translate-x-1/2 -translate-y-1/2 scale-0 text-accent opacity-0 transition-all group-aria-expanded:scale-100 group-aria-expanded:opacity-100"
				class="text-accent"
				fill="none"
				focusable="false"
				id="cross-svg"
				stroke="currentColor"
				stroke-width="1.5"
				viewBox="0 0 24 24"
				xmlns="http://www.w3.org/2000/svg"
			>
				<path d="M6 18L18 6M6 6l12 12" stroke-linecap="round" stroke-linejoin="round"></path>
			</svg>
		</button>
	</mobile-button>
</header>

<script>
	import { toggleClass } from "@/utils";

	class MobileNavBtn extends HTMLElement {
		private headerEl: HTMLElement;
		private menuOpen: boolean;
		private mobileButtonEl: HTMLButtonElement;

		toggleMobileMenu = () => {
			toggleClass(this.headerEl, "menu-open");
			this.menuOpen = !this.menuOpen;
			this.mobileButtonEl.setAttribute("aria-expanded", this.menuOpen.toString());
		};

		constructor() {
			super();
			this.headerEl = document.getElementById("main-header")!;
			this.mobileButtonEl = this.querySelector("button") as HTMLButtonElement;
			this.menuOpen = false;

			this.mobileButtonEl.addEventListener("click", this.toggleMobileMenu);
		}
	}

	customElements.define("mobile-button", MobileNavBtn);
</script>
